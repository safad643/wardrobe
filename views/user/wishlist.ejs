<%- include('../partials/user/header') %>

<div class="wishlist-container">
    <div class="wishlist-header">
        <h1>My Wishlist (<%= products.length %>)</h1>
    </div>

    <div class="wishlist-grid">
        <% if (products.length > 0) { %>
            <% products.forEach(product => { %>
                <div class="wishlist-item" data-product-id="<%= product._id %>">
                    <div class="item-content">
                        <div class="item-image">
                            <a href="/user/product/<%= product.name %>">
                                <img src="<%= product.images[0] %>" alt="<%= product.name %>" />
                            </a>
                        </div>
                        <div class="item-details">
                            <div class="title-row">
                                <h2 class="item-title"><%= product.name %></h2>
                                <div class="action-buttons">
                                    <% if (product.count > 0) { %>
                                        <button onclick="addToCart('<%= product._id %>')" class="cart-btn">
                                            <i class="zmdi zmdi-shopping-cart-plus"></i>
                                        </button>
                                    <% } %>
                                    <button onclick="removeFromWishlist('<%= product._id %>')" class="delete-btn">
                                        <i class="zmdi zmdi-delete"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="price-section">
                                <span class="current-price">₹<%= Math.floor(product.price - (product.price * (product.offer || 0)/100)) %></span>
                                <% if (product.offer && product.offer > 0) { %>
                                    <span class="original-price">₹<%= Math.floor(product.price) %></span>
                                    <span class="discount"><%= product.offer %>% off</span>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="empty-wishlist">
                <i class="far fa-heart"></i>
                <h2>Your wishlist is empty</h2>
                <p>Add items that you like to your wishlist</p>
                <a href="/user/shop" class="continue-shopping">Continue Shopping</a>
            </div>
        <% } %>
    </div>
</div>

<script>
async function removeFromWishlist(productId) {
    try {
        const response = await fetch(`/user/wishlist/remove/${productId}`, {
            method: 'DELETE'
        });
        if (response.ok) {
            document.querySelector(`[data-product-id="${productId}"]`).remove();
            // Update count in header
            updateWishlistCount();
        }
    } catch (error) {
        console.error('Error removing from wishlist:', error);
    }
}

async function addToCart(productId) {
    try {
        const response = await fetch('/user/addtocart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                productid: productId,
                qty: 1
            })
        });
        if (response.ok) {
            // Optionally remove from wishlist after adding to cart
            await removeFromWishlist(productId);
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
    }
}

function updateWishlistCount() {
    const count = document.querySelectorAll('.wishlist-item').length;
    document.querySelector('.wishlist-header h1').textContent = `My Wishlist (${count})`;
}
</script>

<style>
.wishlist-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1rem;
}

.wishlist-header {
    padding: 1rem 0;
    border-bottom: 1px solid #e0e0e0;
    margin-bottom: 1rem;
}

.wishlist-header h1 {
    font-size: 1.25rem;
    color: #212121;
    font-weight: 500;
}

.wishlist-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.wishlist-item {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 1rem;
}

.item-content {
    display: flex;
    gap: 1.5rem;
}

.item-image {
    width: 150px;
    height: 150px;
    flex-shrink: 0;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.item-details {
    flex-grow: 1;
}

.title-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.item-title {
    font-size: 1.1rem;
    color: #212121;
    font-weight: 400;
    line-height: 1.4;
    flex-grow: 1;
    margin-right: 1rem;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.cart-btn, .delete-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}

.cart-btn {
    color: #2874f0;
}

.cart-btn:hover {
    background: #f0f5ff;
}

.delete-btn {
    color: #ff4d4d;
}

.delete-btn:hover {
    background: #fff1f1;
}

.cart-btn i, .delete-btn i {
    font-size: 1.25rem;
}

.price-section {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.current-price {
    font-size: 1.5rem;
    font-weight: 500;
    color: #212121;
}

.original-price {
    color: #878787;
    text-decoration: line-through;
    font-size: 1rem;
}

.discount {
    color: #388e3c;
    font-size: 1rem;
    font-weight: 500;
}

.empty-wishlist {
    text-align: center;
    padding: 3rem 1rem;
    background: #f5f5f5;
    border-radius: 4px;
}

.empty-wishlist i {
    font-size: 3rem;
    color: #878787;
    margin-bottom: 1rem;
}

.empty-wishlist h2 {
    font-size: 1.25rem;
    color: #212121;
    margin-bottom: 0.5rem;
}

.empty-wishlist p {
    color: #878787;
    margin-bottom: 1.5rem;
}

.continue-shopping {
    display: inline-block;
    padding: 0.75rem 2rem;
    background: #2874f0;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.continue-shopping:hover {
    background: #2264d1;
}

@media (max-width: 768px) {
    .item-content {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .title-row {
        flex-direction: column;
        align-items: center;
    }

    .action-buttons {
        margin-top: 0.5rem;
    }

    .item-image {
        width: 120px;
        height: 120px;
    }
}
</style>

